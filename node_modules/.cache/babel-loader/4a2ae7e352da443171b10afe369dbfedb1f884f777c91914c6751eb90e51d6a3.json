{"ast":null,"code":"export class CalculateCommissionsUseCase {\n  /**\r\n   * Ejecuta el cálculo de comisiones.\r\n   * @param {Object} params\r\n   * @param {Array} params.sales - Lista de ventas\r\n   * @param {Array} params.vendors - Lista de vendedores\r\n   * @param {Array} params.rules - Lista de reglas\r\n   * @returns {Array} Lista de comisiones calculadas por vendedor\r\n   */\n  execute({\n    sales,\n    vendors,\n    rules\n  }) {\n    // Es una buena práctica ordenar las reglas de mayor a menor\n    // para asegurar que se aplique la regla correcta (la más alta).\n    const sortedRules = [...rules].sort((a, b) => b.amount - a.amount);\n    return vendors.map(vendor => {\n      // 1. Filtrar las ventas solo para este vendedor\n      const salesForVendor = sales.filter(sale => sale.vendedor_id === vendor.id);\n      let totalCommission = 0;\n\n      // 2. Calcular la comisión para cada venta\n      salesForVendor.forEach(sale => {\n        // 3. Encontrar la regla aplicable para el monto de esta venta\n        // Usamos .find() en las reglas ordenadas. La primera que cumpla\n        // (venta.monto >= regla.amount) será la correcta.\n        const applicableRule = sortedRules.find(rule => sale.monto >= rule.amount);\n        if (applicableRule) {\n          // 4. Acumular la comisión\n          totalCommission += sale.monto * applicableRule.rule;\n        }\n      });\n      return {\n        name: vendor.nombre,\n        totalCommission\n      };\n    });\n  }\n}","map":{"version":3,"names":["CalculateCommissionsUseCase","execute","sales","vendors","rules","sortedRules","sort","a","b","amount","map","vendor","salesForVendor","filter","sale","vendedor_id","id","totalCommission","forEach","applicableRule","find","rule","monto","name","nombre"],"sources":["C:/Users/Usuario/Desktop/Calculo de comisiones MVC/src/domain/useCases/CalculateCommissionsUseCase.js"],"sourcesContent":["export class CalculateCommissionsUseCase {\r\n  /**\r\n   * Ejecuta el cálculo de comisiones.\r\n   * @param {Object} params\r\n   * @param {Array} params.sales - Lista de ventas\r\n   * @param {Array} params.vendors - Lista de vendedores\r\n   * @param {Array} params.rules - Lista de reglas\r\n   * @returns {Array} Lista de comisiones calculadas por vendedor\r\n   */\r\n  execute({ sales, vendors, rules }) {\r\n    \r\n    // Es una buena práctica ordenar las reglas de mayor a menor\r\n    // para asegurar que se aplique la regla correcta (la más alta).\r\n    const sortedRules = [...rules].sort((a, b) => b.amount - a.amount);\r\n\r\n    return vendors.map(vendor => {\r\n      // 1. Filtrar las ventas solo para este vendedor\r\n      const salesForVendor = sales.filter(sale => sale.vendedor_id === vendor.id);\r\n      \r\n      let totalCommission = 0;\r\n\r\n      // 2. Calcular la comisión para cada venta\r\n      salesForVendor.forEach(sale => {\r\n        // 3. Encontrar la regla aplicable para el monto de esta venta\r\n        // Usamos .find() en las reglas ordenadas. La primera que cumpla\r\n        // (venta.monto >= regla.amount) será la correcta.\r\n        const applicableRule = sortedRules.find(rule => sale.monto >= rule.amount);\r\n        \r\n        if (applicableRule) {\r\n          // 4. Acumular la comisión\r\n          totalCommission += sale.monto * applicableRule.rule;\r\n        }\r\n      });\r\n\r\n      return {\r\n        name: vendor.nombre,\r\n        totalCommission,\r\n      };\r\n    });\r\n  }\r\n}"],"mappings":"AAAA,OAAO,MAAMA,2BAA2B,CAAC;EACvC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,OAAOA,CAAC;IAAEC,KAAK;IAAEC,OAAO;IAAEC;EAAM,CAAC,EAAE;IAEjC;IACA;IACA,MAAMC,WAAW,GAAG,CAAC,GAAGD,KAAK,CAAC,CAACE,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAACC,MAAM,GAAGF,CAAC,CAACE,MAAM,CAAC;IAElE,OAAON,OAAO,CAACO,GAAG,CAACC,MAAM,IAAI;MAC3B;MACA,MAAMC,cAAc,GAAGV,KAAK,CAACW,MAAM,CAACC,IAAI,IAAIA,IAAI,CAACC,WAAW,KAAKJ,MAAM,CAACK,EAAE,CAAC;MAE3E,IAAIC,eAAe,GAAG,CAAC;;MAEvB;MACAL,cAAc,CAACM,OAAO,CAACJ,IAAI,IAAI;QAC7B;QACA;QACA;QACA,MAAMK,cAAc,GAAGd,WAAW,CAACe,IAAI,CAACC,IAAI,IAAIP,IAAI,CAACQ,KAAK,IAAID,IAAI,CAACZ,MAAM,CAAC;QAE1E,IAAIU,cAAc,EAAE;UAClB;UACAF,eAAe,IAAIH,IAAI,CAACQ,KAAK,GAAGH,cAAc,CAACE,IAAI;QACrD;MACF,CAAC,CAAC;MAEF,OAAO;QACLE,IAAI,EAAEZ,MAAM,CAACa,MAAM;QACnBP;MACF,CAAC;IACH,CAAC,CAAC;EACJ;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}